# CILS - æ™ºèƒ½è·¨å¢ƒç”µå•† ERP æ ¸å¿ƒç³»ç»Ÿ (Intelligent Cross-Border ERP Core)

> åŸºäº Java 21 + Spring Boot 3 æ„å»ºçš„ä¸‹ä¸€ä»£è·¨å¢ƒç”µå•†ä¸­å°ï¼Œé›†æˆäº† LLM æ™ºèƒ½é£æ§ã€å¤šè¯­è¨€è‡ªåŠ¨ç¿»è¯‘åŠé«˜å¹¶å‘åº“å­˜ç®¡ç†èƒ½åŠ›ã€‚

## ğŸ“– é¡¹ç›®ç®€ä»‹ (Introduction)

CILS (Cross-border Intelligent Listing System) æ˜¯ä¸€ä¸ªé’ˆå¯¹è·¨å¢ƒç”µå•†ï¼ˆAmazon, Shopee ç­‰ï¼‰å¤šå¹³å°é“ºè´§åœºæ™¯è®¾è®¡çš„æ ¸å¿ƒä¸šåŠ¡ä¸­å°ã€‚

é’ˆå¯¹ä¼ ç»Ÿ ERP ç³»ç»Ÿä¸­**äººå·¥å®¡æ ¸æˆæœ¬é«˜ã€å¤šè¯­è¨€ä¸Šæ¶ç¹çã€é«˜å¹¶å‘åº“å­˜è¶…å–**ç­‰è¡Œä¸šç—›ç‚¹ï¼Œæœ¬é¡¹ç›®å¼•å…¥äº† **Google Gemini å¤§æ¨¡å‹** ä¸ **Redis + Kafka é«˜å¹¶å‘æ¶æ„**ï¼Œå®ç°äº†ä»å•†å“å½•å…¥ã€åˆè§„æ ¡éªŒã€è‡ªåŠ¨ç¿»è¯‘åˆ°å¤šå¹³å°æ¨é€çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–é—­ç¯ã€‚

## ğŸ›  æŠ€æœ¯æ ˆ (Tech Stack)

- **æ ¸å¿ƒæ¡†æ¶**: Spring Boot 3.x, Java 21
- **æ•°æ®åº“**: MySQL 8.0 (MyBatis-Plus)
- **ç¼“å­˜ä¸å¹¶å‘**: Redis 7 (åŸå­æŒ‡ä»¤ DECRBY, Cache Aside æ¨¡å¼)
- **æ¶ˆæ¯é˜Ÿåˆ—**: Apache Kafka (æµé‡å‰Šå³°, æœ€ç»ˆä¸€è‡´æ€§)
- **AI å¼•æ“**: Python 3.x (Google GenAI SDK), ProcessBuilder è·¨è¯­è¨€è°ƒç”¨
- **å‰ç«¯**: Vue 3 + Element Plus (éƒ¨åˆ† Vue 2 å…¼å®¹)
- **ä»»åŠ¡è°ƒåº¦**: Spring Scheduled + Quartz
- **å·¥å…·**: Lombok, FastJson2

## ğŸŒŸ æ ¸å¿ƒäº®ç‚¹ (Core Features)

### 1. ğŸ›¡ï¸ åŸºäº LLM çš„å¤šæ¨¡æ€æ™ºèƒ½é£æ§å¼•æ“
æ‘’å¼ƒäº†ä¼ ç»Ÿçš„å…³é”®è¯åŒ¹é…æ¨¡å¼ï¼Œæ„å»ºäº†ä¸€å¥—**è§„åˆ™é©±åŠ¨ (Rule-Driven)** çš„ AI æ ¡éªŒç³»ç»Ÿã€‚
- **å›¾æ–‡ä¸€è‡´æ€§æ£€æµ‹**ï¼šåˆ©ç”¨å¤šæ¨¡æ€å¤§æ¨¡å‹èƒ½åŠ›ï¼Œè‡ªåŠ¨è¯†åˆ« SKU å›¾ç‰‡å†…å®¹æ˜¯å¦ä¸ SPU ç±»ç›®/æ ‡é¢˜åŒ¹é…ï¼Œæœ‰æ•ˆé˜²æ­¢â€œæŒ‚ç¾Šå¤´å–ç‹—è‚‰â€çš„è¿è§„æ“ä½œã€‚
- **åŠ¨æ€è§„åˆ™é…ç½®**ï¼šæ”¯æŒåœ¨æ•°æ®åº“ä¸­åŠ¨æ€é…ç½®æ ¡éªŒ Promptï¼ˆå¦‚è¿ç¦å“æ£€æŸ¥ã€ä¾µæƒæ£€æŸ¥ï¼‰ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆã€‚
- **å¼‚æ­¥/åŒæ­¥åŒæ¨¡å¼**ï¼šæ”¯æŒ SKU å…¥åº“æ—¶çš„**ä¸¥æ ¼åŒæ­¥é˜»æ–­**ï¼Œä»¥åŠ SPU ä¿®æ”¹æ—¶çš„**å¼‚æ­¥éé˜»å¡æ ¡éªŒ**ã€‚

### 2. ğŸš€ é«˜å¹¶å‘åº“å­˜æ‰£å‡æ–¹æ¡ˆ
é’ˆå¯¹ç”µå•†å¤§ä¿ƒåœºæ™¯ï¼Œè®¾è®¡äº†**Redis + Kafka + MySQL** çš„ä¸‰çº§åº“å­˜æ¶æ„ï¼Œå½»åº•è§£å†³è¶…å–é—®é¢˜ã€‚
- **Redis é¢„çƒ­ä¸åŸå­æ‰£å‡**ï¼šå•†å“ä¸Šæ¶è‡ªåŠ¨é¢„çƒ­åº“å­˜ï¼Œåˆ©ç”¨ Redis `DECRBY` å®ç°çº³ç§’çº§æ‰£å‡ï¼ŒæŠ—ä½é«˜å¹¶å‘æµé‡ã€‚
- **Kafka å‰Šå³°å¡«è°·**ï¼šæ‰£å‡æˆåŠŸåå‘é€ MQ æ¶ˆæ¯ï¼Œå¼‚æ­¥æ›´æ–°æ•°æ®åº“ï¼Œä¿æŠ¤æ ¸å¿ƒ DB ä¸è¢«å‡»ç©¿ã€‚
- **æœ€ç»ˆä¸€è‡´æ€§ä¸è¡¥å¿**ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“åº“å­˜çš„æœ€ç»ˆä¸€è‡´ï¼›å½“ MQ å‘é€å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨å›æ»š Redis åº“å­˜ï¼ˆ`INCRBY`ï¼‰ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®ã€‚

### 3. ğŸŒ è‡ªåŠ¨åŒ–å…¨çƒé“ºè´§ (One-Click Mapping)
- **æ™ºèƒ½ Diff æ›´æ–°**ï¼šä¿®æ”¹ SKU æ—¶ï¼Œåç«¯é‡‡ç”¨ Diff ç®—æ³•è‡ªåŠ¨æ¯”å¯¹æ–°æ—§ Mapping åˆ—è¡¨ï¼Œç²¾ç¡®æ‰§è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œï¼Œç¡®ä¿å¤šå¹³å°æ•°æ®åŒæ­¥ã€‚
- **AI å¤šè¯­è¨€ç¿»è¯‘**ï¼šé›†æˆ AI ç¿»è¯‘æœåŠ¡ï¼Œåœ¨æ¨é€å‰æ ¹æ®ç›®æ ‡å›½å®¶ï¼ˆå¦‚æ³°å›½ã€æ—¥æœ¬ï¼‰è‡ªåŠ¨å°†å•†å“ä¿¡æ¯ç¿»è¯‘ä¸ºå½“åœ°è¯­è¨€ï¼Œå¹¶ä¿ç•™åŸæ–‡å¿«ç…§ã€‚
- **çº§è”ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šå®ç°äº† SKU ä¸ Mapping çš„å¼ºå…³è”ï¼ŒSKU é€»è¾‘åˆ é™¤æ—¶è‡ªåŠ¨çº§è”ä¸‹æ¶/åˆ é™¤å¯¹åº”å¹³å°çš„ Mappingï¼Œä¿è¯æ•°æ®çº¯å‡€åº¦ã€‚

### 4. ğŸ’± å®æ—¶æ±‡ç‡ä¸åŠ¨æ€å®šä»·
- **å¤šå¸ç§æ”¯æŒ**ï¼šé›†æˆ ExchangeRate-API v6ï¼Œæ”¯æŒå¯åŠ¨è‡ªåŠ¨åˆ·æ–°ä¸å®šæ—¶åŒæ­¥ã€‚
- **å…œåº•ç­–ç•¥ (Fallback)**ï¼šè®¾è®¡äº†æœ¬åœ°å…œåº•æ±‡ç‡æœºåˆ¶ï¼Œå½“å¤–éƒ¨ API ä¸å¯ç”¨æˆ–ç½‘ç»œå¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨é™çº§ä½¿ç”¨é¢„è®¾æ±‡ç‡ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­ã€‚
- **å‰ç«¯å®æ—¶è”åŠ¨**ï¼šSKU å®šä»·é¡µé¢æ”¯æŒåŸºäºæ±‡ç‡å’Œå€ç‡çš„å®æ—¶ä»·æ ¼è®¡ç®—ã€‚

## ğŸ“ æ¶æ„è®¾è®¡ (Architecture)

### ä¸šåŠ¡æµç¨‹

```mermaid
graph TD
    User((è¿è¥äººå‘˜)) -->|1. æ–°å¢/ä¿®æ”¹| SPU[SPU æ ‡å‡†å“]
    SPU -->|2. è¡ç”Ÿ| SKU[SKU é”€å”®è§„æ ¼]

    subgraph AI_Core [AI æ™ºèƒ½æ ¸å¿ƒ]
        SKU -->|3. è§¦å‘æ ¡éªŒ| Engine{æ ¡éªŒå¼•æ“}
        Engine -->|4. è°ƒç”¨| Python[Python è„šæœ¬]
        Python <-->|5. API| LLM[Gemini å¤§æ¨¡å‹]
    end

    Engine -- Block -->|6a. æ‹¦æˆª| DB[(æ•°æ®åº“)]
    Engine -- Pass -->|6b. é€šè¿‡| Mapping[Mapping æ˜ å°„]

    subgraph Push_System [æ¨é€ç³»ç»Ÿ]
        Mapping -->|7. è‡ªåŠ¨ç¿»è¯‘| Trans[AI ç¿»è¯‘æœåŠ¡]
        Trans -->|8. åˆ†å‘| Strategy{æ¨é€ç­–ç•¥}
        Strategy -->|9. API| Amazon[Amazon]
        Strategy -->|9. API| Shopee[Shopee]
    end
```

### ç›®å½•ç»“æ„ (Structure)

```text
com.john.cils
â”œâ”€â”€ common          // é€šç”¨æ¨¡å—
â”‚   â””â”€â”€ constant    // å¸¸é‡å®šä¹‰ (CilsConstants)
â”œâ”€â”€ controller      // æ§åˆ¶å±‚ (Restful API)
â”‚   â””â”€â”€ å„ä¸ªå‰ç«¯è®¿é—®æ¥å£
â”œâ”€â”€ domain          // é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ dto         // å·¥å…·å®ä½“
â”‚   â””â”€â”€ å„ä¸ªè¡¨çš„å®ä½“  // æ•°æ®åº“å®ä½“ (SPU, SKU, Mapping)
â”œâ”€â”€ mapper          // æ•°æ®è®¿é—®å±‚ (MyBatis Mapper XML)
â”œâ”€â”€ mq              // æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å—
â”‚   â””â”€â”€ StockConsumer.java  // åº“å­˜æ‰£å‡æ¶ˆè´¹è€…
â”œâ”€â”€ service         // ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ impl        // ä¸šåŠ¡å®ç° (SkuServiceImpl åŒ…å«æ ¸å¿ƒ Diff é€»è¾‘)
â”‚   â”œâ”€â”€ push        // æ¨é€ç­–ç•¥ (Strategy Pattern å®ç°)
â”‚   â”œâ”€â”€ ... ä¸šåŠ¡å¤„ç†
â”‚   â””â”€â”€ ExchangeRateService.java // æ±‡ç‡æœåŠ¡ (å«å…œåº•ç­–ç•¥)
â”œâ”€â”€ task            // å®šæ—¶ä»»åŠ¡
â”‚   â””â”€â”€ ExchangeRateRefreshTask.java // æ¯æ—¥æ±‡ç‡åˆ·æ–°
â”œâ”€â”€ utils           // æ ¸å¿ƒå·¥å…·
â”‚   â”œâ”€â”€ python      // Python è„šæœ¬è°ƒç”¨å·¥å…· (ProcessBuilder)
â”‚   â””â”€â”€ platform    // æ¨¡æ‹Ÿå¹³å°æ¨é€è„šæœ¬
â””â”€â”€ verification    // AI æ ¡éªŒå¼•æ“æ ¸å¿ƒ
    â”œâ”€â”€ async       // å¼‚æ­¥è°ƒåº¦ (AsyncVerificationService)
    â”œâ”€â”€ engine      // è§„åˆ™æ‰§è¡Œå™¨ (VerificationEngine)
    â””â”€â”€ domain      // æ ¡éªŒç»“æœå¯¹è±¡
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Getting Started)

1.  **ç¯å¢ƒå‡†å¤‡**ï¼š
    *   JDK 21, Maven 3.8+
    *   MySQL 8.0, Redis, Kafka, Zookeeper
    *   Python 3.x (éœ€å®‰è£… `google-generativeai` åº“)
2.  **é…ç½®**ï¼š
    *   åœ¨ `application.yml` ä¸­é…ç½®æ•°æ®åº“ã€Redisã€Kafka è¿æ¥ã€‚
    *   è®¾ç½®ç¯å¢ƒå˜é‡ `GOOGLE_API_KEY` (ç”¨äº AI) å’Œ `EXCHANGERATE_API_KEY` (ç”¨äºæ±‡ç‡)ã€‚
3.  **å¯åŠ¨**ï¼š
    *   è¿è¡Œ `RuoYiApplication.java`ã€‚
    *   ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åŒæ­¥æœ€æ–°æ±‡ç‡ã€‚

## ğŸ“ å¼€å‘è®¡åˆ’ (Roadmap)

- [x] SPU/SKU æ ¸å¿ƒç®¡ç†
- [x] AI æ™ºèƒ½é£æ§ä¸ç¿»è¯‘
- [x] é«˜å¹¶å‘åº“å­˜æ‰£å‡
- [ ] å¯¹æ¥ Amazon SP-API çœŸå®æ²™ç®±ç¯å¢ƒ
- [ ] å¼•å…¥ Sentinel è¿›è¡Œå…¨é“¾è·¯ç†”æ–­é™çº§

---
*Author: John | Tech Stack: Java 21, Spring Boot 3, Vue 3*
